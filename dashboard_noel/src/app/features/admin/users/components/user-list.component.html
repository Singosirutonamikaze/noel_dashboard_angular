<div class="h-full flex flex-col bg-gray-50">
  <div class="bg-white rounded-4 mb-4 px-6 py-4">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Gestion des utilisateurs</h1>
        <p class="text-sm text-gray-600 mt-1">Liste des comptes utilisateurs</p>
      </div>
      <button
        (click)="onCreateUser()"
        class="px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors flex items-center gap-2"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 4v16m8-8H4"
          />
        </svg>
        Ajouter utilisateur
      </button>
    </div>

    <div class="flex gap-4">
      <div class="flex-1">
        <input
          type="text"
          placeholder="Rechercher par nom ou email..."
          [value]="searchQuery()"
          (input)="onSearch($any($event.target).value)"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
        />
      </div>

      <select
        title="Filtrer par rôle"
        [value]="filterRole()"
        (change)="onFilterRole($any($event.target).value)"
        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
      >
        <option value="ALL">Tous les rôles</option>
        <option [value]="UserRole.ADMIN">Administrateur</option>
        <option [value]="UserRole.USER">Utilisateur</option>
        <option [value]="UserRole.EMERGENCY_SERVICE">Service d'urgence</option>
      </select>

      <select
        title="Filtrer par statut"
        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
      >
        <option value="ALL">Tous les statuts</option>
        <option value="ACTIVE">Actif</option>
        <option value="INACTIVE">Inactif</option>
      </select>
    </div>
  </div>

  <div class="flex-1 overflow-hidden flex">
    <div class="flex-1 overflow-y-auto p-6">
      @if (error()) {
      <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg mb-4">
        {{ error() }}
      </div>
      } @if (isLoading()) {
      <div class="flex items-center justify-center h-64">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-500"></div>
      </div>
      } @else if (filteredUsers().length === 0) {
      <div class="text-center py-12">
        <svg
          class="mx-auto h-12 w-12 text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
          />
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">Aucun utilisateur</h3>
        <p class="mt-1 text-sm text-gray-500">Commencez par créer un nouvel utilisateur.</p>
      </div>
      } @else {
      <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
        <table class="w-full">
          <thead class="bg-gray-50 border-b border-gray-200">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Nom
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Email
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Rôle
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Statut
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Date d'inscription
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Actions
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            @for (user of filteredUsers(); track user.id) {
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap">
                <button
                  (click)="onViewDetails(user)"
                  class="text-emerald-600 hover:text-emerald-700 font-medium text-left"
                >
                  {{ user.firstName }} {{ user.lastName }}
                </button>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                {{ user.email }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  [class]="
                    'px-3 py-1 text-xs font-medium rounded-full ' + getRoleBadgeClass(user.role)
                  "
                >
                  {{ getRoleLabel(user.role) }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="px-3 py-1 text-xs font-medium rounded-full bg-emerald-100 text-emerald-700"
                >
                  Actif
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                {{ getFormattedDate(user.id) }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <button
                  title="open boutton"
                  (click)="onOpenActionsMenu(user, $event)"
                  class="text-gray-400 hover:text-gray-600 transition-colors"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"
                    />
                  </svg>
                </button>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      }
    </div>

    @if (selectedUser() || showCreateForm()) {
    <div class="w-96 border-l border-gray-200 bg-white overflow-y-auto">
      @if (showCreateForm()) {
      <app-user-form (close)="onCloseForm()" (userCreated)="onUserCreated()"> </app-user-form>
      } @else if (selectedUser()) {
      <app-user-detail
        [user]="selectedUser()!"
        (close)="onCloseDetails()"
        (userUpdated)="loadUsers()"
        (userDeleted)="onDeleteUser($event)"
      >
      </app-user-detail>
      }
    </div>
    }
  </div>
</div>
