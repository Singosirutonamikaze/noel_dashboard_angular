<div class="h-full flex flex-col bg-linear-to-b from-gray-50 to-white">
  <!-- Header Card -->
  <div class="bg-white rounded-2xl m-6 mb-4 shadow-sm border border-gray-100">
    <div class="px-6 py-5">
      <div class="flex items-center justify-between mb-6">
        <div class="animate-in fade-in slide-in-from-left-4 duration-500">
          <h1 class="text-2xl font-bold text-gray-900 tracking-tight">Gestion des utilisateurs</h1>
          <p class="text-sm text-gray-600 mt-1.5">Liste des comptes utilisateurs</p>
        </div>
        <button
          (click)="onCreateUser()"
          class="px-5 py-2.5 bg-linear-to-r from-emerald-500 to-emerald-600 text-white rounded-xl hover:from-emerald-600 hover:to-emerald-700 transition-all flex items-center gap-2.5 font-medium shadow-lg shadow-emerald-500/30 hover:shadow-xl hover:shadow-emerald-500/40 hover:scale-105 animate-in fade-in slide-in-from-right-4 duration-500"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4v16m8-8H4"
            />
          </svg>
          Ajouter utilisateur
        </button>
      </div>

      <!-- Filters -->
      <div class="flex gap-3 animate-in fade-in slide-in-from-bottom-4 duration-500 delay-100">
        <div class="flex-1 relative group">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none transition-all duration-200 group-focus-within:text-emerald-500"
          >
            <svg
              class="w-5 h-5 text-gray-400 group-focus-within:text-emerald-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              />
            </svg>
          </div>
          <input
            type="text"
            placeholder="Rechercher par nom ou email..."
            [value]="searchQuery()"
            (input)="onSearch($any($event.target).value)"
            class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200 bg-linear-to-br from-white to-gray-50 placeholder:text-gray-400"
          />
        </div>

        <div class="relative">
          <select
            title="Filtrer par rôle"
            [value]="filterRole()"
            (change)="onFilterRole($any($event.target).value)"
            class="pl-4 pr-10 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200 bg-linear-to-br from-white to-gray-50 appearance-none cursor-pointer min-w-45 font-medium"
          >
            <option value="ALL">Tous les rôles</option>
            <option [value]="UserRole.ADMIN">Administrateur</option>
            <option [value]="UserRole.USER">Utilisateur</option>
            <option [value]="UserRole.EMERGENCY_SERVICE">Service d'urgence</option>
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
            <svg
              class="w-5 h-5 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              />
            </svg>
          </div>
        </div>

        <div class="relative">
          <select
            title="Filtrer par statut"
            class="pl-4 pr-10 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200 bg-linear-to-br from-white to-gray-50 appearance-none cursor-pointer min-w-40 font-medium"
          >
            <option value="ALL">Tous les statuts</option>
            <option value="ACTIVE">Actif</option>
            <option value="INACTIVE">Inactif</option>
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
            <svg
              class="w-5 h-5 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              />
            </svg>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="flex-1 overflow-hidden flex mx-6 mb-6">
    <div class="flex-1 overflow-y-auto">
      @if (error()) {
      <div
        class="bg-linear-to-r from-red-50 to-red-100 border border-red-200 text-red-800 px-4 py-3 rounded-xl mb-4 shadow-sm animate-in fade-in slide-in-from-top-2 duration-300"
      >
        {{ error() }}
      </div>
      } @if (isLoading()) {
      <div class="flex items-center justify-center h-64">
        <div class="relative">
          <div class="animate-spin rounded-full h-16 w-16 border-4 border-emerald-200"></div>
          <div
            class="animate-spin rounded-full h-16 w-16 border-t-4 border-emerald-500 absolute top-0 left-0"
          ></div>
        </div>
      </div>
      } @else if (filteredUsers().length === 0) {
      <div
        class="text-center py-16 bg-white rounded-2xl border border-gray-100 shadow-sm animate-in fade-in zoom-in duration-500"
      >
        <div
          class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-linear-to-br from-gray-100 to-gray-200 mb-4"
        >
          <svg class="h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
            />
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-900 mb-1">Aucun utilisateur</h3>
        <p class="text-sm text-gray-500">Commencez par créer un nouvel utilisateur.</p>
      </div>
      } @else {
      <div
        class="bg-white rounded-2xl border border-gray-100 overflow-hidden shadow-sm animate-in fade-in slide-in-from-bottom-4 duration-500"
      >
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-linear-to-b from-gray-50 to-gray-100/50 border-b border-gray-200">
              <tr>
                <th
                  class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                >
                  Nom
                </th>
                <th
                  class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                >
                  Email
                </th>
                <th
                  class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                >
                  Rôle
                </th>
                <th
                  class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                >
                  Statut
                </th>
                <th
                  class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                >
                  Date d'inscription
                </th>
                <th
                  class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                >
                  Actions
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-100">
              @for (user of filteredUsers(); track user.id; let i = $index) {
              <tr
                class="hover:bg-linear-to-r hover:from-emerald-50/30 hover:to-transparent transition-all duration-200 group"
                [style.animation]="'fadeIn 0.3s ease-in-out ' + (i * 0.05) + 's backwards'"
              >
                <td class="px-6 py-4 whitespace-nowrap">
                  <button
                    (click)="onViewDetails(user)"
                    class="text-emerald-600 hover:text-emerald-700 font-semibold text-left transition-all duration-200 hover:underline decoration-2 underline-offset-2"
                  >
                    {{ user.firstName }} {{ user.lastName }}
                  </button>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 font-medium">
                  {{ user.email }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span
                    [class]="
                      'px-3 py-1.5 text-xs font-semibold rounded-full shadow-sm transition-all duration-200 group-hover:scale-105 ' +
                      getRoleBadgeClass(user.role)
                    "
                  >
                    {{ getRoleLabel(user.role) }}
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span
                    class="px-3 py-1.5 text-xs font-semibold rounded-full bg-linear-to-r from-emerald-100 to-emerald-200 text-emerald-700 shadow-sm transition-all duration-200 group-hover:scale-105"
                  >
                    Actif
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 font-medium">
                  {{ getFormattedDate(user.id) }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <button
                    title="open boutton"
                    (click)="onOpenActionsMenu(user, $event)"
                    class="text-gray-400 hover:text-emerald-600 transition-all duration-200 hover:scale-110 hover:rotate-90"
                  >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"
                      />
                    </svg>
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
      }
    </div>

    <!-- Sidebar Panel -->
    @if (selectedUser() || showCreateForm()) {
    <div
      class="w-96 ml-4 border border-gray-100 bg-white rounded-2xl overflow-hidden shadow-sm animate-in fade-in slide-in-from-right-4 duration-300"
    >
      @if (showCreateForm()) {
      <app-user-form (close)="onCloseForm()" (userCreated)="onUserCreated()"> </app-user-form>
      } @else if (selectedUser()) {
      <app-user-detail
        [user]="selectedUser()!"
        (close)="onCloseDetails()"
        (userUpdated)="loadUsers()"
        (userDeleted)="onDeleteUser($event)"
      >
      </app-user-detail>
      }
    </div>
    }
  </div>
</div>

<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
