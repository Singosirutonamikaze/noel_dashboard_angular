<div class="h-full flex flex-col bg-linear-to-b from-gray-50 to-white">
  <!-- Header -->
  <div class="bg-white border-b border-gray-100 shadow-sm">
    <div class="px-6 py-5">
      <div class="flex items-center justify-between">
        <div class="animate-in fade-in slide-in-from-left-4 duration-500">
          <h1 class="text-2xl font-bold text-gray-900 tracking-tight">Mon Profil</h1>
          <p class="text-sm text-gray-600 mt-1.5">Gérez vos informations personnelles</p>
        </div>
        <button
          (click)="onRefresh()"
          [disabled]="isLoading()"
          class="px-5 py-2.5 bg-linear-to-r from-emerald-500 to-emerald-600 text-white rounded-xl hover:from-emerald-600 hover:to-emerald-700 transition-all flex items-center gap-2.5 font-medium shadow-lg shadow-emerald-500/30 hover:shadow-xl hover:shadow-emerald-500/40 disabled:opacity-50 disabled:cursor-not-allowed hover:scale-105 animate-in fade-in slide-in-from-right-4 duration-500"
        >
          <svg
            class="w-5 h-5"
            [class.animate-spin]="isLoading()"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            />
          </svg>
          Actualiser
        </button>
      </div>
    </div>
  </div>

  <div class="flex-1 overflow-y-auto p-6">
    @if (error()) {
    <div
      class="bg-linear-to-r from-red-50 to-red-100 border border-red-200 text-red-800 px-4 py-3 rounded-xl mb-6 shadow-sm animate-in fade-in slide-in-from-top-2 duration-300"
    >
      {{ error() }}
    </div>
    } @if (isLoading() && !profile()) {
    <div class="flex items-center justify-center h-64">
      <div class="relative">
        <div class="animate-spin rounded-full h-16 w-16 border-4 border-emerald-200"></div>
        <div
          class="animate-spin rounded-full h-16 w-16 border-t-4 border-emerald-500 absolute top-0 left-0"
        ></div>
      </div>
    </div>
    } @else if (profile()) {
    <div class="space-y-6">
      <!-- Profile Card -->
      <div class="animate-in fade-in slide-in-from-bottom-4 duration-500">
        <app-profile-card
          [profile]="profile()!"
          [editable]="true"
          (edit)="onEditProfile()"
          (photoClick)="onPhotoUpload()"
        ></app-profile-card>
      </div>

      <!-- Tabs -->
      <div
        class="bg-white rounded-2xl border border-gray-100 shadow-sm animate-in fade-in slide-in-from-bottom-4 duration-500 delay-100"
      >
        <div class="border-b border-gray-100">
          <nav class="flex gap-1 p-2">
            <button
              *ngFor="let tab of tabs"
              (click)="activeTab.set(tab.id)"
              [class]="
                'flex-1 px-4 py-3 text-sm font-semibold rounded-xl transition-all duration-200 ' +
                (activeTab() === tab.id
                  ? 'bg-linear-to-r from-emerald-500 to-emerald-600 text-white shadow-lg shadow-emerald-500/30'
                  : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900')
              "
            >
              {{ tab.label }}
            </button>
          </nav>
        </div>

        <div class="p-6">
          <!-- Profile Info Tab -->
          @if (activeTab() === 'info') { @if (!editMode()) {
          <div class="space-y-4 animate-in fade-in slide-in-from-right-2 duration-300">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div
                class="p-5 bg-linear-to-br from-gray-50 to-gray-100/50 rounded-xl border border-gray-100"
              >
                <div class="text-xs font-semibold text-gray-500 mb-2 uppercase tracking-wider">
                  Téléphone
                </div>
                <div class="text-base font-medium text-gray-900">{{ profile()!.phone }}</div>
              </div>
              <div
                class="p-5 bg-linear-to-br from-gray-50 to-gray-100/50 rounded-xl border border-gray-100"
              >
                <div class="text-xs font-semibold text-gray-500 mb-2 uppercase tracking-wider">
                  Adresse
                </div>
                <div class="text-base font-medium text-gray-900">
                  {{ profile()!.address || 'Non renseigné' }}
                </div>
              </div>
              <div
                class="p-5 bg-linear-to-br from-gray-50 to-gray-100/50 rounded-xl border border-gray-100"
              >
                <div class="text-xs font-semibold text-gray-500 mb-2 uppercase tracking-wider">
                  Ville
                </div>
                <div class="text-base font-medium text-gray-900">
                  {{ profile()!.city || 'Non renseigné' }}
                </div>
              </div>
              <div
                class="p-5 bg-linear-to-br from-gray-50 to-gray-100/50 rounded-xl border border-gray-100"
              >
                <div class="text-xs font-semibold text-gray-500 mb-2 uppercase tracking-wider">
                  Pays
                </div>
                <div class="text-base font-medium text-gray-900">
                  {{ profile()!.country || 'Non renseigné' }}
                </div>
              </div>
            </div>
            <button
              (click)="onEditProfile()"
              class="mt-4 px-5 py-2.5 bg-linear-to-r from-emerald-500 to-emerald-600 text-white rounded-xl hover:from-emerald-600 hover:to-emerald-700 transition-all duration-200 font-medium shadow-lg shadow-emerald-500/30 hover:shadow-xl hover:shadow-emerald-500/40 hover:scale-105"
            >
              Modifier les informations
            </button>
          </div>
          } @else {
          <app-profile-form
            [initialData]="getProfileUpdateDto()"
            [title]="''"
            (submitForm)="onUpdateProfile($event)"
            (cancel)="editMode.set(false)"
          ></app-profile-form>
          } }

          <!-- Vehicle Tab -->
          @if (activeTab() === 'vehicle') {
          <div class="animate-in fade-in slide-in-from-right-2 duration-300">
            <app-vehicle-form
              [initialData]="getVehicleDto()"
              (submitForm)="onUpdateVehicle($event)"
            ></app-vehicle-form>
          </div>
          }

          <!-- Settings Tab -->
          @if (activeTab() === 'settings') {
          <div class="animate-in fade-in slide-in-from-right-2 duration-300">
            <app-settings-form (settingsLoaded)="onSettingsLoaded($event)"></app-settings-form>
          </div>
          }

          <!-- Privacy Tab -->
          @if (activeTab() === 'privacy') {
          <div class="animate-in fade-in slide-in-from-right-2 duration-300">
            <app-privacy-form (privacyLoaded)="onPrivacyLoaded($event)"></app-privacy-form>
          </div>
          }

          <!-- Danger Zone Tab -->
          @if (activeTab() === 'danger') {
          <div class="animate-in fade-in slide-in-from-right-2 duration-300">
            <div
              class="bg-linear-to-r from-red-50 to-red-100 border-2 border-red-200 rounded-xl p-6"
            >
              <h3 class="text-lg font-bold text-red-900 mb-2">Zone dangereuse</h3>
              <p class="text-sm text-red-700 mb-6">
                Cette action est irréversible. Toutes vos données seront définitivement supprimées.
              </p>
              <button
                (click)="onDeleteAccount()"
                class="px-5 py-2.5 bg-linear-to-r from-red-500 to-red-600 text-white rounded-xl hover:from-red-600 hover:to-red-700 transition-all duration-200 font-medium shadow-lg shadow-red-500/30 hover:shadow-xl hover:shadow-red-500/40 hover:scale-105"
              >
                Supprimer mon compte
              </button>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
    }
  </div>
  <input
    title="image file"
    #fileInput
    type="file"
    accept="image/*"
    (change)="onFileSelected($event)"
    class="hidden"
  />
</div>
